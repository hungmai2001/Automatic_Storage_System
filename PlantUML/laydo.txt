@startuml
participant ESP32CAM
box #LightBlue
participant FrontEnd
participant BackEnd
end box
participant ESP32
activate FrontEnd
activate ESP32
activate ESP32CAM
activate BackEnd

FrontEnd --> FrontEnd : **<color red>Nhấn nút LẤY ĐỒ</color>**
activate FrontEnd #005500
 
== **<color green>So sánh khuôn mặt</color>** ==
FrontEnd --> ESP32CAM : [websocket] Capture
loop until face detected 10 times continuously
   activate ESP32CAM #20a4d8
   ESP32CAM --> FrontEnd : [websocket] Gửi hình ảnh
   FrontEnd --> FrontEnd : Nhận diện khuôn mặt, hiển thị hình ảnh
end
FrontEnd --> ESP32CAM : [MQTT] Dừng capture
deactivate ESP32CAM 
FrontEnd --> FrontEnd : Tải xuống hình ảnh
deactivate FrontEnd
BackEnd --> BackEnd : Phát hiện hình ảnh trong folder\ndownload. So sánh với hình ảnh\ntrong thư mục lưu trữ
activate BackEnd #ef2731 
alt#Gold #EEEBDC Có khuôn mặt trùng khớp
    BackEnd --> ESP32: [MQTT] Xóa vân tay [id]
    deactivate BackEnd 
    activate ESP32 #efde27
    ESP32 --> ESP32: Xóa vân tay [id]
    ESP32 --> ESP32: Cập nhật led tủ
    ESP32 --> FrontEnd: [MQTT] Mở tủ [id]
    deactivate ESP32 
    activate FrontEnd #005500
    FrontEnd --> FrontEnd : Hiển thị thông báo/nút nhấn
    deactivate FrontEnd
else #d49b89 Không có khuôn mặt trùng khớp
== **<color green>So sánh vân tay</color>** ==
    activate BackEnd #ef2731
BackEnd --> FrontEnd: [MQTT] Không tìm thấy khuôn mặt
deactivate BackEnd
activate FrontEnd #005500
FrontEnd --> ESP32: [MQTT] So sánh vân tay
deactivate FrontEnd 
activate ESP32 #efde27
ESP32 --> ESP32 : Lấy mẫu vân tay và so sánh
ESP32 --> ESP32 : Cập nhật led tủ
ESP32 --> FrontEnd: [MQTT] Gửi kết quả so sánh
deactivate ESP32
activate FrontEnd #005500
FrontEnd --> FrontEnd : Hiển thị thông báo/nút nhấn

end

@enduml